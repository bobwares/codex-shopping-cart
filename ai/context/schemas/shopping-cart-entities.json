{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "./entity-specs/shopping-cart-entities.json",
  "title": "shopping_cart Domain Entities",
  "type": "object",
  "x-db": {
    "schema": "shopping_cart"
  },
  "definitions": {
    "ShoppingCart": {
      "type": "object",
      "properties": {
        "cart_id": { "type": "string", "format": "uuid" },
        "user_id": { "type": "string", "format": "uuid" },
        "subtotal": { "type": "number", "minimum": 0 },
        "tax": { "type": "number", "minimum": 0 },
        "shipping": { "type": "number", "minimum": 0 },
        "total": { "type": "number", "minimum": 0 },
        "currency": { "type": "string", "minLength": 3, "maxLength": 3 },
        "created_at": { "type": "string", "format": "date-time" },
        "updated_at": { "type": "string", "format": "date-time" }
      },
      "required": [
        "cart_id",
        "user_id",
        "subtotal",
        "tax",
        "shipping",
        "total",
        "currency",
        "created_at",
        "updated_at"
      ],
      "x-db": {
        "primaryKey": ["cart_id"],
        "unique": [["user_id", "cart_id"]],
        "indexes": [["user_id"]]
      }
    },
    "ShoppingCartItem": {
      "type": "object",
      "properties": {
        "item_id": { "type": "integer" },
        "cart_id": { "type": "string", "format": "uuid" },
        "product_id": { "type": "string", "maxLength": 100 },
        "name": { "type": "string", "maxLength": 255 },
        "quantity": { "type": "integer", "minimum": 1 },
        "unit_price": { "type": "number", "minimum": 0 },
        "total_price": { "type": "number", "minimum": 0 },
        "currency": { "type": "string", "minLength": 3, "maxLength": 3 }
      },
      "required": [
        "item_id",
        "cart_id",
        "product_id",
        "name",
        "quantity",
        "unit_price",
        "total_price"
      ],
      "x-db": {
        "primaryKey": ["item_id"],
        "foreignKey": [
          { "column": "cart_id", "ref": "ShoppingCart.cart_id", "onDelete": "CASCADE" }
        ],
        "unique": [["cart_id", "product_id"]],
        "indexes": [["cart_id"]]
      }
    },
    "ShoppingCartDiscount": {
      "type": "object",
      "properties": {
        "discount_id": { "type": "integer" },
        "cart_id": { "type": "string", "format": "uuid" },
        "code": { "type": "string", "maxLength": 64 },
        "amount": { "type": "number", "minimum": 0 }
      },
      "required": [
        "discount_id",
        "cart_id",
        "amount"
      ],
      "x-db": {
        "primaryKey": ["discount_id"],
        "foreignKey": [
          { "column": "cart_id", "ref": "ShoppingCart.cart_id", "onDelete": "CASCADE" }
        ],
        "unique": [["cart_id", "code"]],
        "indexes": [["cart_id"]]
      }
    }
  }
}
